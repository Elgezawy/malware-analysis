# malware-analysis

malware is executabile or binary that is malicious by nature 
attackers used malwares for >
1- spy on target > remote code execution RATs - keylogger
2- Data exfilteration
3- Data encryption and destruction > rasomware
4- download additional malware

malware analysis is the process of analysing malware sample/binary and extract as much information 
this info will help yo understand the scope of the fuctionality of the  malware
( how system infected {target or phishing} and how to defened in futher ) 
how malware communicate withe attacker C2C server
show registery - new files - ip - url (iocs) to generate signature

types of malware analysis:
1-static analysis: without execution >> extract extracte metadata strings - PE header
2-dynnamic analysis: execute malware and analyzing its functionality and behavior >> what it is doing : done by debugger (idapro)
3-code analysis: revrse engineering assembly code
4-behavioural analysis: analyzing and monitoring the malware after execution ( process - registry - network - file - exfilteratr - domain - ip - DNS )

install sandbox >>
1-install laset updated hypervisor with network configurtion HOST only
2-no usb / take snapshots
3-compressed the sample with password
4-disaple sharing folers - windows defender - updates
5-set-ExecutionPlicy unrestricted
install FLARE vm fire eys : windows malware analysis destribution with tools
unistall vm guest addition >> will decress the performance
2-Fakenet >> run as admin 
  you can edit setting from fakenet.cfg
  like dump output : yes >> will saved all traffic in pcap file
  
# static analysis
-file type : targrt os , archticture(x32,x64) , formate (dll,exe)
-malware : hash of it after and before execution
-strings : idea of what that malwar can do
-packing and obfustication : technigues used to prevent detection >> packer = UPX
-PE header : malware fuctionality

........................................................................
lets take a sample 
1- HxD - hex editor : view ther pe header and file header for file signature
MZ [4D 5A] >> file exeutabile
PE [50 45] >> PE header 
signature >> this program can't run in DOS mode
2- Exeifo PE: detect if the exeutable has been packed and the paker version and how ro unpacked
3- pestudio : lot of info
    - strigs
    - hashs mdf, etc
    - first byte in text - hex
    - file type >> dynnamic link library dll
    - cpu >> architecure 32 - 64 bit
4- PEID >> strings - disassembler 
hashing sample for identifcation >> we can check it in virus total - urlscan

string analysis : the process of extracting readable characters and words from malware >> for malware functionality
types of strings we are looking for is:
  1- file names
  2- URLs domain connected to attacker cnc
  3- ips 
  4- Registry keys >> setting up preistance 
 attacker may injuct fake or garbage strings 
 
 
 PAKERS :tool comprised the malware
 attacker use packers to obfusticate the content of malware > this make it hard to analysis
 Exeifo PE : used to detect paker and how to unpacked >> UPX 

.........................................................................................................

 PE header:
 1-contain all important and necessary info required by OS to execute the executable
 2-comtain where the sample needs to be loaded in to memory
 3-contain librarys dll executable requried
 4-contain where exec begin
 
 PE Header Structure
 > MZ Header/DOS Header : Defines the file as an executable binary
 > DOS Stub (Program cannot be run in DOS mode) : Prints a message when run in DOS (Exists for compatibility)
 > PE File Header (Signature) : Defines the executable as a PE
 > Image Optional Header : Stores important information about the executable: Like the subsystem and the entry point
 > Sections Table : Instructions on how to load the executable into memory
 > Sections : Executable sections of code and data used by the executable
    -- .code / .text : Executable code
    -- .data         : Stores Data (R/W)
    -- .rdata        : Stores Data (Read Only)
    -- .idata        : Stores The Import Table
    -- .edata        : Stores Export Data
    -- .rsrc         : Stores Resources (Strings, icons)
    
 PE header analysis:
 1-compiler stamp : when and where malware compiled >> file header in pestudio
 2-what subsystem is being used >> optinal header
 3-sections : is packed >> directers
 4-libarary and imports : tell us the functionality >> sorted by blacklisted / importac and descrition  
  -kernal32.dll >> used by malware to interacte with system  
    (files > create - delete etc) 
    (process > start - terminate etc)
    (loadlibraryA)
  -advapi32.dll >> modifiying - interacting with registry
    (registry delete - modify etc) -- persistance
  -wsock32.dll - wininet.dll >> used to socket connection
    (socket - connect - sent etc)
 5-Resource hacker : show resources section and important info
 ....................................................................................................................
 #yara rules
 -hashing failed for malware identification and classification >> so yara come to play in
 -what is yara rule :tool for malware identification and classification work by matching patterns(ips - cnc - domain - signature ..etc) across various malware sample
 -it identify samples based on specific strings or binary data 
 -YARA structure
   rule <rule name>
  {
  meta:
       description = "          "
  strings:
       $a="url for example"
       $mz={4D 5A}
  }
 .....................................................................................................................
  
  #GHIDRA 
  -dynamic malware analysis tool >> debugger - disassemoler - decompiler code but is not good as IDA pro
  -can generate YARA rule for specific fuction or piece of code 
  -able as well to compare  two files or functions 
